<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard SEO Pro - Suivi de R√©f√©rencement</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-green-500: rgba(34, 197, 94, 1);

            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-green-500-rgb: 34, 197, 94;

            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-success: var(--color-teal-500);
            --color-error: var(--color-red-500);

            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-base: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-success: var(--color-teal-300);
                --color-error: var(--color-red-400);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
            padding: var(--space-20);
            line-height: 1.6;
        }

        .header {
            margin-bottom: var(--space-24);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: var(--space-8);
        }

        .header p {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .config-section {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            margin-bottom: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .config-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: var(--space-16);
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }

        .config-icon {
            width: 20px;
            height: 20px;
            color: var(--color-primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-16);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text);
        }

        .form-input {
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-background);
            color: var(--color-text);
            font-size: 14px;
            font-family: var(--font-family-base);
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .btn {
            padding: var(--space-12) var(--space-20);
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(var(--color-brown-600-rgb), 0.05);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .metric-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            box-shadow: var(--shadow-sm);
        }

        .metric-label {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
            font-weight: 500;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: var(--space-8);
        }

        .metric-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metric-change.positive {
            color: var(--color-success);
        }

        .metric-change.negative {
            color: var(--color-error);
        }

        .data-section {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            margin-bottom: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-16);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: var(--space-12);
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text-secondary);
            border-bottom: 1px solid var(--color-border);
        }

        td {
            padding: var(--space-12);
            font-size: 14px;
            border-bottom: 1px solid var(--color-border);
        }

        tr:last-child td {
            border-bottom: none;
        }

        .position-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
        }

        .position-top3 {
            background: rgba(var(--color-green-500-rgb), 0.15);
            color: var(--color-green-500);
        }

        .position-top10 {
            background: rgba(var(--color-teal-500-rgb), 0.15);
            color: var(--color-primary);
        }

        .position-other {
            background: rgba(var(--color-slate-500-rgb), 0.15);
            color: var(--color-text-secondary);
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        .trend-up {
            color: var(--color-success);
        }

        .trend-down {
            color: var(--color-error);
        }

        .trend-stable {
            color: var(--color-text-secondary);
        }

        .loading {
            text-align: center;
            padding: var(--space-24);
            color: var(--color-text-secondary);
        }

        .error-message {
            background: rgba(var(--color-red-500-rgb), 0.1);
            color: var(--color-error);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: var(--space-8);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--space-20);
        }

        .tab {
            padding: var(--space-12) var(--space-20);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--color-text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--color-text);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            height: 300px;
            margin-top: var(--space-16);
            position: relative;
        }

        .chart-placeholder {
            width: 100%;
            height: 100%;
            background: var(--color-background);
            border-radius: var(--radius-base);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .domain-selector {
            display: flex;
            gap: var(--space-12);
            margin-bottom: var(--space-20);
            flex-wrap: wrap;
        }

        .domain-chip {
            padding: var(--space-8) var(--space-16);
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .domain-chip:hover {
            border-color: var(--color-primary);
        }

        .domain-chip.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        @media (max-width: 768px) {
            body {
                padding: var(--space-12);
            }

            .header h1 {
                font-size: 24px;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-12);
            }
        }
    </style>
</head>
<body>
    <div id="login-screen" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--color-background);">
        <div style="background: var(--color-surface); border: 1px solid var(--color-card-border); border-radius: var(--radius-lg); padding: 40px; box-shadow: var(--shadow-sm); max-width: 400px; width: 100%;">
            <h2 style="text-align: center; margin-bottom: 24px; font-size: 24px;">üîí Acc√®s s√©curis√©</h2>
            <p style="text-align: center; color: var(--color-text-secondary); margin-bottom: 24px; font-size: 14px;">
                Veuillez entrer le mot de passe pour acc√©der au dashboard SEO
            </p>
            <div class="form-group">
                <label class="form-label" for="password-input">Mot de passe</label>
                <input type="password" id="password-input" class="form-input" placeholder="Entrez le mot de passe" onkeypress="handlePasswordKeypress(event)">
            </div>
            <div id="login-error" style="color: var(--color-error); font-size: 13px; margin-top: 8px; display: none;">
                Mot de passe incorrect
            </div>
            <button class="btn" style="width: 100%; margin-top: 16px;" onclick="checkPassword()">Se connecter</button>
        </div>
    </div>

    <div id="dashboard-app" style="display: none;">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üöÄ Dashboard SEO Pro</h1>
                    <p>Suivi de r√©f√©rencement pour vos nouveaux sites web</p>
                </div>
                <button class="btn btn-secondary" onclick="logout()" style="padding: 8px 16px; font-size: 13px;">
                    üîì D√©connexion
                </button>
            </div>
        </div>

    <div class="config-section">
        <div class="config-title">
            <svg class="config-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            Configuration API
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dataforseo')">DataForSEO</button>
            <button class="tab" onclick="switchTab('ahrefs')">Ahrefs</button>
        </div>

        <div id="dataforseo-config" class="tab-content active">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" for="dataforseo-login">Login DataForSEO</label>
                    <input type="text" id="dataforseo-login" class="form-input" placeholder="Votre login">
                </div>
                <div class="form-group">
                    <label class="form-label" for="dataforseo-password">Mot de passe API</label>
                    <input type="password" id="dataforseo-password" class="form-input" placeholder="Votre mot de passe API">
                </div>
                <div class="form-group">
                    <label class="form-label" for="dataforseo-domain">Domaine √† suivre</label>
                    <input type="text" id="dataforseo-domain" class="form-input" placeholder="exemple.com">
                </div>
                <div class="form-group">
                    <label class="form-label" for="dataforseo-keywords">Mots-cl√©s (un par ligne)</label>
                    <textarea id="dataforseo-keywords" class="form-input" rows="4" placeholder="mot-cl√© 1&#10;mot-cl√© 2&#10;mot-cl√© 3"></textarea>
                </div>
            </div>
            <div style="margin-top: 16px; display: flex; gap: 12px;">
                <button class="btn" onclick="connectDataForSEO()">Connecter et charger les donn√©es</button>
                <button class="btn btn-secondary" onclick="testConnection('dataforseo')">Tester la connexion</button>
            </div>
            <p style="color: var(--color-text-secondary); margin-top: 16px; font-size: 13px;">
                üí° <strong>Note :</strong> DataForSEO vous permet de suivre les positions de vos mots-cl√©s sur Google. 
                Les donn√©es seront r√©cup√©r√©es via l'API SERP de DataForSEO pour chaque mot-cl√©.
            </p>
        </div>

        <div id="ahrefs-config" class="tab-content">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" for="ahrefs-token">Token API Ahrefs</label>
                    <input type="password" id="ahrefs-token" class="form-input" placeholder="Votre token API Ahrefs">
                </div>
            </div>
            <div style="margin-top: 16px; display: flex; gap: 12px;">
                <button class="btn" onclick="connectAhrefs()">Connecter Ahrefs</button>
                <button class="btn btn-secondary" onclick="testConnection('ahrefs')">Tester la connexion</button>
            </div>
        </div>

        <div id="demo-config" class="tab-content">
            <p style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px;">
                <strong>üìå Comment ajouter vos URLs dans SERPbear :</strong>
            </p>
            <ol style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px; line-height: 1.8; padding-left: 24px;">
                <li>Connectez-vous √† votre instance SERPbear (par d√©faut : <code>http://localhost:3000</code>)</li>
                <li>Cliquez sur <strong>"Add Domain"</strong> pour ajouter un nouveau site web</li>
                <li>Cliquez sur <strong>"Add Keyword"</strong> pour ajouter les mots-cl√©s √† suivre</li>
                <li>Configurez un scraper (ScrapingRobot, ScrapingAnt ou Proxy) dans les param√®tres</li>
                <li>SERPbear r√©cup√©rera automatiquement les positions de vos mots-cl√©s</li>
            </ol>
            <p style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px;">
                <strong>üîë O√π trouver la cl√© API SERPbear ?</strong>
            </p>
            <ol style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px; line-height: 1.8; padding-left: 24px;">
                <li>La cl√© API est d√©finie lors de l'installation de SERPbear dans le fichier <code>.env</code> ou <code>docker-compose.yaml</code></li>
                <li>Recherchez la variable <code>APIKEY=votre_cle_api</code> dans votre configuration</li>
                <li>Si vous avez install√© SERPbear via Docker, v√©rifiez votre fichier <code>docker-compose.yaml</code></li>
                <li>Exemple : <code>APIKEY=5saedXklbslhnapihe2pihp3pih4fdnakhjwq5</code></li>
                <li>Vous pouvez g√©n√©rer une cl√© al√©atoire de 64 caract√®res avec un g√©n√©rateur en ligne</li>
            </ol>
            <p style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px;">
                <strong>üîå API SERPbear disponibles :</strong>
            </p>
            <ul style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px; line-height: 1.8; padding-left: 24px;">
                <li><code>GET /api/domains</code> - R√©cup√©rer tous les domaines</li>
                <li><code>GET /api/keywords?domain=exemple.com</code> - R√©cup√©rer les mots-cl√©s d'un domaine</li>
                <li><code>GET /api/keyword?id=22</code> - R√©cup√©rer les d√©tails d'un mot-cl√©</li>
                <li><code>POST /api/refresh</code> - Rafra√Æchir les positions</li>
            </ul>
            <p style="background: rgba(var(--color-teal-500-rgb), 0.1); padding: 12px; border-radius: 8px; color: var(--color-text-secondary); font-size: 13px;">
                üí° <strong>Note :</strong> SERPbear n'a pas d'API pour ajouter des domaines/mots-cl√©s. Vous devez les ajouter via l'interface web de SERPbear, puis utiliser ce dashboard pour visualiser les donn√©es via l'API de lecture.
            </p>
        </div>
    </div>

        <div id="error-container"></div>

        <div id="dashboard-content" style="display: none;">
        <div class="domain-selector" id="domain-selector"></div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Mots-cl√©s suivis</div>
                <div class="metric-value" id="total-keywords">0</div>
                <div class="metric-change positive" id="keywords-change">
                    <span>‚Üó</span> +0 cette semaine
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Position moyenne</div>
                <div class="metric-value" id="avg-position">-</div>
                <div class="metric-change" id="position-change">
                    <span>‚Üí</span> Stable
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Top 3</div>
                <div class="metric-value" id="top3-count">0</div>
                <div class="metric-change positive" id="top3-change">
                    <span>‚Üó</span> +0%
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Top 10</div>
                <div class="metric-value" id="top10-count">0</div>
                <div class="metric-change positive" id="top10-change">
                    <span>‚Üó</span> +0%
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Backlinks</div>
                <div class="metric-value" id="backlinks-count">0</div>
                <div class="metric-change positive" id="backlinks-change">
                    <span>‚Üó</span> +0 ce mois
                </div>
            </div>
        </div>

        <div class="data-section">
            <div class="section-header">
                <h2 class="section-title">√âvolution des positions</h2>
                <select class="form-input" style="width: auto;" id="chart-period" onchange="updateChart()">
                    <option value="7">7 derniers jours</option>
                    <option value="14">14 derniers jours</option>
                    <option value="30" selected>30 derniers jours</option>
                    <option value="90">90 derniers jours</option>
                </select>
            </div>
            <div class="chart-container">
                <div class="chart-placeholder" id="chart-area">
                    Les donn√©es du graphique s'afficheront ici une fois connect√©
                </div>
            </div>
        </div>

        <div class="data-section">
            <div class="section-header">
                <h2 class="section-title">Positions des mots-cl√©s</h2>
                <div style="display: flex; gap: 12px;">
                    <select class="form-input" style="width: auto;" id="filter-position" onchange="filterKeywords()">
                        <option value="all">Toutes positions</option>
                        <option value="top3">Top 3</option>
                        <option value="top10">Top 10</option>
                        <option value="top20">Top 20</option>
                        <option value="top50">Top 50</option>
                    </select>
                    <button class="btn btn-secondary" onclick="refreshData()">
                        <svg style="width: 16px; height: 16px; display: inline; vertical-align: middle;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Actualiser
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table id="keywords-table">
                    <thead>
                        <tr>
                            <th>Mot-cl√©</th>
                            <th>Position</th>
                            <th>Tendance</th>
                            <th>Changement</th>
                            <th>URL</th>
                            <th>Derni√®re m√†j</th>
                        </tr>
                    </thead>
                    <tbody id="keywords-tbody">
                        <tr>
                            <td colspan="6" class="loading">Chargement des donn√©es...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        </div>
    </div>

    <script>
        const CORRECT_PASSWORD = 'jaee2025';
        let isAuthenticated = false;

        function loadSavedConfig() {
            const saved = localStorage.getItem('seo_dashboard_config');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    if (config.dataforseo) {
                        document.getElementById('dataforseo-login').value = config.dataforseo.login || '';
                        document.getElementById('dataforseo-password').value = config.dataforseo.password || '';
                        document.getElementById('dataforseo-domain').value = config.dataforseo.domain || '';
                        document.getElementById('dataforseo-keywords').value = config.dataforseo.keywords?.join('\n') || '';
                    }
                    if (config.ahrefs) {
                        document.getElementById('ahrefs-token').value = config.ahrefs.token || '';
                    }
                } catch (e) {
                    console.error('Error loading saved config:', e);
                }
            }
        }

        function saveConfig() {
            const config = {
                dataforseo: {
                    login: document.getElementById('dataforseo-login').value.trim(),
                    password: document.getElementById('dataforseo-password').value.trim(),
                    domain: document.getElementById('dataforseo-domain').value.trim(),
                    keywords: document.getElementById('dataforseo-keywords').value.trim().split('\n').map(k => k.trim()).filter(k => k)
                },
                ahrefs: {
                    token: document.getElementById('ahrefs-token').value.trim()
                }
            };
            localStorage.setItem('seo_dashboard_config', JSON.stringify(config));
        }

        function checkPassword() {

            if (passwordInput.value === CORRECT_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard-app').style.display = 'block';
                loginError.style.display = 'none';
                passwordInput.value = '';
                loadSavedConfig();
            } else {
            const passwordInput = document.getElementById('password-input');
            const loginError = document.getElementById('login-error');
            
            if (passwordInput.value === CORRECT_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard-app').style.display = 'block';
                loginError.style.display = 'none';
                passwordInput.value = '';
            } else {
                loginError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        function handlePasswordKeypress(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }

        function logout() {
            isAuthenticated = false;
            document.getElementById('dashboard-app').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('password-input').focus();
        }

        window.onload = function() {
            document.getElementById('password-input').focus();
        };

        let currentData = null;
        let currentDomain = null;
        let apiConfig = {
            type: null,
            dataforseo: { login: '', password: '', domain: '', keywords: [] },
            ahrefs: { token: '' }
        };

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-config`).classList.add('active');
        }

        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        function showSuccess(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div style="background: rgba(var(--color-green-500-rgb), 0.1); color: var(--color-success); padding: 16px; border-radius: 8px; margin-bottom: 16px; font-size: 14px;">${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 3000);
        }

        async function connectDataForSEO() {
            const login = document.getElementById('dataforseo-login').value.trim();
            const password = document.getElementById('dataforseo-password').value.trim();
            const domain = document.getElementById('dataforseo-domain').value.trim();
            const keywordsText = document.getElementById('dataforseo-keywords').value.trim();

            if (!login || !password || !domain || !keywordsText) {
                showError('Veuillez remplir tous les champs (login, password, domaine et mots-cl√©s)');
                return;
            }

            saveConfig();

            const keywords = keywordsText.split('\n').map(k => k.trim()).filter(k => k);
            if (keywords.length === 0) {
                showError('Veuillez entrer au moins un mot-cl√©');
                return;
            }

            apiConfig.type = 'dataforseo';
            apiConfig.dataforseo = { login, password, domain, keywords };

            try {
                const auth = btoa(`${login}:${password}`);
                const tasks = keywords.map(keyword => ({
                    language_code: "fr",
                    location_code: 2250,
                    keyword: keyword,
                    device: "desktop",
                    os: "windows"
                }));

                const response = await fetch('https://api.dataforseo.com/v3/serp/google/organic/live/advanced', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${auth}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tasks)
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }

                const data = await response.json();
                
                currentData = {
                    domains: [{
                        name: domain,
                        keywords: keywords.length,
                        backlinks: 0,
                        backlinkChange: 0
                    }],
                    keywords: []
                };

                currentDomain = domain;

                data.tasks.forEach((task, index) => {
                    if (task.result && task.result[0]) {
                        const items = task.result[0].items || [];
                        const domainResult = items.find(item => 
                            item.domain && item.domain.includes(domain.replace('www.', ''))
                        );

                        const position = domainResult ? domainResult.rank_absolute : 0;
                        const url = domainResult ? domainResult.url : '';

                        currentData.keywords.push({
                            keyword: keywords[index],
                            position: position,
                            change: 0,
                            trend: 'stable',
                            url: url,
                            lastUpdate: new Date().toISOString(),
                            domain: domain,
                            history: [position]
                        });
                    }
                });

                document.getElementById('dashboard-content').style.display = 'block';
                renderDomainSelector();
                updateMetrics();
                renderKeywordsTable();
                renderChart();
                showSuccess(`‚úÖ Donn√©es DataForSEO charg√©es avec succ√®s! ${currentData.keywords.length} mots-cl√©s analys√©s.`);
            } catch (error) {
                showError(`Erreur de connexion √† DataForSEO: ${error.message}`);
                console.error('DataForSEO error:', error);
            }
        }

        async function connectAhrefs() {
            const token = document.getElementById('ahrefs-token').value.trim();

            if (!token) {
                showError('Veuillez remplir le token API Ahrefs');
                return;
            }

            saveConfig();

            apiConfig.type = 'ahrefs';
            apiConfig.ahrefs = { token };

            if (currentData && currentData.domains.length > 0) {
                try {
                    for (let domain of currentData.domains) {
                        const response = await fetch(`https://api.ahrefs.com/v3/site-explorer/metrics-extended?target=${domain.name}&mode=domain`, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Accept': 'application/json'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`Erreur HTTP: ${response.status}`);
                        }

                        const data = await response.json();
                        domain.backlinks = data.metrics?.backlinks || 0;
                        domain.backlinkChange = data.metrics?.backlinks_growth_30d || 0;
                    }

                    updateMetrics();
                    showSuccess('‚úÖ Donn√©es Ahrefs charg√©es avec succ√®s!');
                } catch (error) {
                    showError(`Erreur de connexion √† Ahrefs: ${error.message}`);
                    console.error('Ahrefs error:', error);
                }
            } else {
                showSuccess('Configuration Ahrefs enregistr√©e. Connectez d\'abord SERPbear pour charger les domaines.');
            }
        }

        async function testConnection(type) {
            if (type === 'dataforseo') {
                const login = document.getElementById('dataforseo-login').value.trim();
                const password = document.getElementById('dataforseo-password').value.trim();
                if (!login || !password) {
                    showError('Veuillez remplir tous les champs avant de tester');
                    return;
                }
                showSuccess('Test de connexion DataForSEO... En production, ceci v√©rifierait GET /v3/appendix/user_data');
            } else if (type === 'ahrefs') {
                const token = document.getElementById('ahrefs-token').value.trim();
                if (!token) {
                    showError('Veuillez remplir tous les champs avant de tester');
                    return;
                }
                showSuccess('Test de connexion Ahrefs... En production, ceci v√©rifierait GET https://api.ahrefs.com/v3/site-explorer/metrics-extended');
            }
        }

        function loadDemoData() {
            currentData = {
                domains: [],
                keywords: [
                    { keyword: 'agence SEO Madrid', position: 3, change: 2, trend: 'up', url: 'https://exemple-seo.com/agence-seo', lastUpdate: '2025-11-21', domain: 'exemple-seo.com', history: [5, 4, 3] },
                    { keyword: 'consultant SEO', position: 7, change: -1, trend: 'down', url: 'https://exemple-seo.com/consultant', lastUpdate: '2025-11-21', domain: 'exemple-seo.com', history: [6, 7, 7] },
                    { keyword: 'r√©f√©rencement naturel', position: 12, change: 3, trend: 'up', url: 'https://exemple-seo.com/referencement', lastUpdate: '2025-11-21', domain: 'exemple-seo.com', history: [15, 13, 12] },
                    { keyword: 'audit SEO gratuit', position: 2, change: 0, trend: 'stable', url: 'https://exemple-seo.com/audit', lastUpdate: '2025-11-21', domain: 'exemple-seo.com', history: [2, 2, 2] },
                    { keyword: 'optimisation site web', position: 18, change: -3, trend: 'down', url: 'https://exemple-seo.com/optimisation', lastUpdate: '2025-11-21', domain: 'exemple-seo.com', history: [15, 17, 18] },
                    { keyword: 'marketing digital', position: 1, change: 1, trend: 'up', url: 'https://nouveau-site.fr/marketing', lastUpdate: '2025-11-21', domain: 'nouveau-site.fr', history: [2, 1, 1] },
                    { keyword: 'strat√©gie contenu', position: 24, change: 0, trend: 'stable', url: 'https://nouveau-site.fr/strategie', lastUpdate: '2025-11-21', domain: 'nouveau-site.fr', history: [24, 24, 24] },
                    { keyword: 'cr√©ation site internet', position: 9, change: 4, trend: 'up', url: 'https://nouveau-site.fr/creation', lastUpdate: '2025-11-21', domain: 'nouveau-site.fr', history: [13, 11, 9] },
                    { keyword: 'agencia SEO Espa√±a', position: 4, change: 1, trend: 'up', url: 'https://agence-web.es/agencia', lastUpdate: '2025-11-21', domain: 'agence-web.es', history: [5, 5, 4] },
                    { keyword: 'dise√±o web responsive', position: 6, change: -2, trend: 'down', url: 'https://agence-web.es/diseno', lastUpdate: '2025-11-21', domain: 'agence-web.es', history: [4, 5, 6] },
                    { keyword: 'posicionamiento web', position: 11, change: 0, trend: 'stable', url: 'https://agence-web.es/posicionamiento', lastUpdate: '2025-11-21', domain: 'agence-web.es', history: [11, 11, 11] },
                    { keyword: 'an√°lisis competencia', position: 8, change: 2, trend: 'up', url: 'https://agence-web.es/analisis', lastUpdate: '2025-11-21', domain: 'agence-web.es', history: [10, 9, 8] }
                ]
            };

            currentDomain = currentData.domains[0].name;
            document.getElementById('dashboard-content').style.display = 'block';
            renderDomainSelector();
            updateMetrics();
            renderKeywordsTable();
            renderChart();
        }

        function renderDomainSelector() {
            const selector = document.getElementById('domain-selector');
            selector.innerHTML = currentData.domains.map(domain => 
                `<div class="domain-chip ${domain.name === currentDomain ? 'active' : ''}" onclick="selectDomain('${domain.name}')">
                    ${domain.name} (${domain.keywords} mots-cl√©s)
                </div>`
            ).join('');
        }

        async function selectDomain(domainName) {
            currentDomain = domainName;
            renderDomainSelector();
            updateMetrics();
            renderKeywordsTable();
            renderChart();
        }

        function updateMetrics() {
            const domainKeywords = currentData.keywords.filter(k => k.domain === currentDomain);
            const totalKeywords = domainKeywords.length;
            const avgPosition = (domainKeywords.reduce((sum, k) => sum + k.position, 0) / totalKeywords).toFixed(1);
            const top3 = domainKeywords.filter(k => k.position <= 3).length;
            const top10 = domainKeywords.filter(k => k.position <= 10).length;

            document.getElementById('total-keywords').textContent = totalKeywords;
            document.getElementById('avg-position').textContent = avgPosition;
            document.getElementById('top3-count').textContent = top3;
            document.getElementById('top10-count').textContent = top10;

            const positionTrend = domainKeywords.reduce((sum, k) => sum + k.change, 0);
            const positionChangeEl = document.getElementById('position-change');
            if (positionTrend > 0) {
                positionChangeEl.innerHTML = '<span>‚Üó</span> En am√©lioration';
                positionChangeEl.className = 'metric-change positive';
            } else if (positionTrend < 0) {
                positionChangeEl.innerHTML = '<span>‚Üò</span> En baisse';
                positionChangeEl.className = 'metric-change negative';
            } else {
                positionChangeEl.innerHTML = '<span>‚Üí</span> Stable';
                positionChangeEl.className = 'metric-change';
            }

            document.getElementById('top3-change').innerHTML = `<span>‚Üó</span> ${Math.round((top3/totalKeywords)*100)}%`;
            document.getElementById('top10-change').innerHTML = `<span>‚Üó</span> ${Math.round((top10/totalKeywords)*100)}%`;

            const domainInfo = currentData.domains.find(d => d.name === currentDomain);
            document.getElementById('backlinks-count').textContent = domainInfo.backlinks.toLocaleString('fr-FR');
            
            const backlinksChangeEl = document.getElementById('backlinks-change');
            if (domainInfo.backlinkChange > 0) {
                backlinksChangeEl.innerHTML = `<span>‚Üó</span> +${domainInfo.backlinkChange} ce mois`;
                backlinksChangeEl.className = 'metric-change positive';
            } else if (domainInfo.backlinkChange < 0) {
                backlinksChangeEl.innerHTML = `<span>‚Üò</span> ${domainInfo.backlinkChange} ce mois`;
                backlinksChangeEl.className = 'metric-change negative';
            } else {
                backlinksChangeEl.innerHTML = `<span>‚Üí</span> Aucun changement`;
                backlinksChangeEl.className = 'metric-change';
            }
        }

        function renderKeywordsTable() {
            const domainKeywords = currentData.keywords.filter(k => k.domain === currentDomain);
            const filter = document.getElementById('filter-position').value;
            
            let filteredKeywords = domainKeywords;
            if (filter === 'top3') filteredKeywords = domainKeywords.filter(k => k.position <= 3);
            else if (filter === 'top10') filteredKeywords = domainKeywords.filter(k => k.position <= 10);
            else if (filter === 'top20') filteredKeywords = domainKeywords.filter(k => k.position <= 20);
            else if (filter === 'top50') filteredKeywords = domainKeywords.filter(k => k.position <= 50);

            const tbody = document.getElementById('keywords-tbody');
            tbody.innerHTML = filteredKeywords.map(kw => {
                const positionClass = kw.position <= 3 ? 'position-top3' : kw.position <= 10 ? 'position-top10' : 'position-other';
                const trendClass = kw.trend === 'up' ? 'trend-up' : kw.trend === 'down' ? 'trend-down' : 'trend-stable';
                const trendSymbol = kw.trend === 'up' ? '‚Üó' : kw.trend === 'down' ? '‚Üò' : '‚Üí';
                const changeText = kw.change > 0 ? `+${kw.change}` : kw.change;

                return `
                    <tr>
                        <td><strong>${kw.keyword}</strong></td>
                        <td><span class="position-badge ${positionClass}">#${kw.position}</span></td>
                        <td><span class="trend-indicator ${trendClass}">${trendSymbol}</span></td>
                        <td><span class="${trendClass}">${changeText}</span></td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${kw.url}">${kw.url}</td>
                        <td style="color: var(--color-text-secondary); font-size: 13px;">${new Date(kw.lastUpdate).toLocaleDateString('fr-FR')}</td>
                    </tr>
                `;
            }).join('');

            if (filteredKeywords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--color-text-secondary);">Aucun mot-cl√© ne correspond aux filtres s√©lectionn√©s</td></tr>';
            }
        }

        function renderChart() {
            const domainKeywords = currentData.keywords.filter(k => k.domain === currentDomain);
            const chartArea = document.getElementById('chart-area');
            
            const avgPositions = [];
            const days = 30;
            for (let i = 0; i < days; i++) {
                const variation = Math.sin(i / 5) * 2 + Math.random() * 1.5;
                avgPositions.push(8 + variation);
            }

            const maxPos = Math.max(...avgPositions);
            const minPos = Math.min(...avgPositions);
            const range = maxPos - minPos;

            const points = avgPositions.map((pos, i) => {
                const x = (i / (days - 1)) * 100;
                const y = ((pos - minPos) / range) * 80 + 10;
                return `${x},${100 - y}`;
            }).join(' ');

            chartArea.innerHTML = `
                <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none" style="border-radius: 8px;">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color: var(--color-primary); stop-opacity: 0.3" />
                            <stop offset="100%" style="stop-color: var(--color-primary); stop-opacity: 0.05" />
                        </linearGradient>
                    </defs>
                    <polyline points="0,100 ${points} 100,100" fill="url(#gradient)" />
                    <polyline points="${points}" fill="none" stroke="var(--color-primary)" stroke-width="0.5" vector-effect="non-scaling-stroke" />
                </svg>
                <div style="position: absolute; bottom: 8px; left: 12px; font-size: 11px; color: var(--color-text-secondary);">
                    √âvolution sur ${days} jours (Position moyenne)
                </div>
            `;
        }

        function filterKeywords() {
            renderKeywordsTable();
        }

        function updateChart() {
            renderChart();
        }

        async function refreshData() {
            if (apiConfig.type === 'dataforseo') {
                await connectDataForSEO();
            } else {
                showSuccess('Actualisation des donn√©es...');
                setTimeout(() => {
                    updateMetrics();
                    renderKeywordsTable();
                    renderChart();
                }, 500);
            }
        }
    </script>
</body>
</html>

